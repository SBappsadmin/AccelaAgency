/*
	Call the Master Scripts
*/
var SCRIPT_VERSION = 2.0
eval(getScriptText("INCLUDES_ACCELA_FUNCTIONS"));
eval(getScriptText("INCLUDES_ACCELA_GLOBALS"));
eval(getScriptText("INCLUDES_CUSTOM"));

/*
	CE parcel list received from Code Enforcement in April 2016
	I couldn't do all parcels at once because Accela timed out, so I broke them
	apart into chunks of 300
*/
var CEParcelList1_200 = ["71-08-01-102-002.000-026",
"71-08-02-308-004.000-026",
"71-08-02-308-006.000-026",
"71-08-02-308-017.000-026",
"71-08-02-309-009.000-026",
"71-08-02-309-010.000-026",
"71-08-02-310-007.000-026",
"71-08-02-310-012.000-026",
"71-08-02-351-001.000-026",
"71-08-02-351-002.000-026",
"71-08-02-351-004.000-026",
"71-08-02-351-005.000-026",
"71-08-02-351-006.000-026",
"71-08-02-352-001.000-026",
"71-08-02-352-006.000-026",
"71-08-02-352-015.000-026",
"71-08-02-353-001.000-026",
"71-08-02-353-005.000-026",
"71-08-02-353-006.000-026",
"71-08-02-354-016.000-026",
"71-08-02-355-007.000-026",
"71-08-02-355-011.000-026",
"71-08-02-355-013.000-026",
"71-08-02-355-014.000-026",
"71-08-02-355-018.000-026",
"71-08-02-355-021.000-026",
"71-08-02-356-008.000-026",
"71-08-02-356-011.000-026",
"71-08-02-356-015.000-026",
"71-08-02-356-021.000-026",
"71-08-02-356-028.000-026",
"71-08-02-356-035.000-026",
"71-08-02-356-036.000-026",
"71-08-02-357-014.000-026",
"71-08-02-357-015.000-026",
"71-08-02-357-023.000-026",
"71-08-02-357-024.000-026",
"71-08-02-357-029.000-026",
"71-08-02-357-030.000-026",
"71-08-02-357-031.000-026",
"71-08-02-357-035.000-026",
"71-08-02-357-041.000-026",
"71-08-02-358-002.000-026",
"71-08-02-358-004.000-026",
"71-08-02-358-008.000-026",
"71-08-02-358-014.000-026",
"71-08-02-358-023.000-026",
"71-08-02-377-005.000-026",
"71-08-02-377-008.000-026",
"71-08-02-377-026.000-026",
"71-08-02-378-010.000-026",
"71-08-02-378-014.000-026",
"71-08-02-378-020.000-026",
"71-08-02-378-021.000-026",
"71-08-02-378-023.000-026",
"71-08-02-378-034.000-026",
"71-08-02-379-038.000-026",
"71-08-02-379-042.000-026",
"71-08-02-380-018.000-026",
"71-08-02-382-010.000-026",
"71-08-02-456-005.000-026",
"71-08-02-460-016.000-026",
"71-08-02-460-018.000-026",
"71-08-02-461-004.000-026",
"71-08-03-151-009.000-026",
"71-08-03-155-003.000-026",
"71-08-03-182-001.000-026",
"71-08-03-182-005.000-026",
"71-08-03-183-007.000-026",
"71-08-03-184-017.000-026",
"71-08-03-184-020.000-026",
"71-08-03-260-004.000-026",
"71-08-03-260-012.000-026",
"71-08-03-260-013.000-026",
"71-08-03-260-014.000-026",
"71-08-03-260-015.000-026",
"71-08-03-260-016.000-026",
"71-08-03-261-004.000-026",
"71-08-03-301-005.000-026",
"71-08-03-301-008.000-026",
"71-08-03-305-007.000-026",
"71-08-03-305-018.000-026",
"71-08-03-306-005.000-026",
"71-08-03-306-006.000-026",
"71-08-03-306-010.000-026",
"71-08-03-306-021.000-026",
"71-08-03-327-002.000-026",
"71-08-03-327-024.000-026",
"71-08-03-328-001.000-026",
"71-08-03-328-006.000-026",
"71-08-03-328-010.000-026",
"71-08-03-328-014.000-026",
"71-08-03-328-020.000-026",
"71-08-03-328-021.000-026",
"71-08-03-328-026.000-026",
"71-08-03-328-027.000-026",
"71-08-03-329-002.000-026",
"71-08-03-329-004.000-026",
"71-08-03-329-008.000-026",
"71-08-03-381-010.000-026",
"71-08-03-381-012.000-026",
"71-08-03-381-013.000-026",
"71-08-03-381-015.000-026",
"71-08-03-381-016.000-026",
"71-08-03-382-006.000-026",
"71-08-03-382-011.000-026",
"71-08-03-385-001.000-026",
"71-08-03-385-012.000-026",
"71-08-03-385-013.000-026",
"71-08-03-385-014.000-026",
"71-08-03-386-005.000-026",
"71-08-03-387-011.000-026",
"71-08-03-387-012.000-026",
"71-08-03-401-001.000-026",
"71-08-03-401-006.000-026",
"71-08-03-404-003.000-026",
"71-08-03-404-009.000-026",
"71-08-03-404-012.000-026",
"71-08-03-407-001.000-026",
"71-08-03-407-002.000-026",
"71-08-03-407-004.000-026",
"71-08-03-407-012.000-026",
"71-08-03-408-002.000-026",
"71-08-03-408-020.000-026",
"71-08-03-408-022.000-026",
"71-08-03-408-028.000-026",
"71-08-03-408-029.000-026",
"71-08-03-409-015.000-026",
"71-08-03-411-001.000-026",
"71-08-03-411-002.000-026",
"71-08-03-411-003.000-026",
"71-08-03-412-009.000-026",
"71-08-03-412-011.000-026",
"71-08-03-412-013.000-026",
"71-08-03-413-006.000-026",
"71-08-03-413-011.000-026",
"71-08-03-426-002.000-026",
"71-08-03-426-003.000-026",
"71-08-03-426-007.000-026",
"71-08-03-426-013.000-026",
"71-08-03-431-004.000-026",
"71-08-03-431-011.000-026",
"71-08-03-434-005.000-026",
"71-08-03-434-007.000-026",
"71-08-03-434-014.000-026",
"71-08-03-434-016.000-026",
"71-08-03-434-017.000-026",
"71-08-03-434-022.000-026",
"71-08-03-434-030.000-026",
"71-08-03-434-032.000-026",
"71-08-03-434-033.000-026",
"71-08-03-435-008.000-026",
"71-08-03-438-005.000-026",
"71-08-03-451-010.000-026",
"71-08-03-451-011.000-026",
"71-08-03-451-013.000-026",
"71-08-03-451-023.000-026",
"71-08-03-451-024.000-026",
"71-08-03-452-004.000-026",
"71-08-03-452-021.000-026",
"71-08-03-452-022.000-026",
"71-08-03-452-024.000-026",
"71-08-03-452-025.000-026",
"71-08-03-453-002.000-026",
"71-08-03-453-003.000-026",
"71-08-03-453-004.000-026",
"71-08-03-453-011.000-026",
"71-08-03-453-012.000-026",
"71-08-03-453-013.000-026",
"71-08-03-453-031.000-026",
"71-08-03-453-032.000-026",
"71-08-03-453-036.000-026",
"71-08-03-453-037.000-026",
"71-08-03-454-012.000-026",
"71-08-03-454-017.000-026",
"71-08-03-455-013.000-026",
"71-08-03-455-023.000-026",
"71-08-03-456-004.000-026",
"71-08-03-456-005.000-026",
"71-08-03-456-006.000-026",
"71-08-03-456-011.000-026",
"71-08-03-457-017.000-026",
"71-08-03-457-022.000-026",
"71-08-03-457-023.000-026",
"71-08-03-457-026.000-026",
"71-08-03-457-027.000-026",
"71-08-03-459-015.000-026",
"71-08-03-461-010.000-026",
"71-08-03-461-011.000-026",
"71-08-03-461-018.000-026",
"71-08-03-477-010.000-026",
"71-08-03-477-011.000-026",
"71-08-03-478-001.000-026",
"71-08-03-478-002.000-026",
"71-08-03-478-004.000-026",
"71-08-03-479-002.000-026",
"71-08-03-479-018.000-026",
"71-08-03-479-019.000-026",
"71-08-03-479-020.000-026",
"71-08-03-479-021.000-026",
"71-08-03-479-025.000-026"]
var CEParcelList201_400 = ["71-08-03-479-026.000-026",
"71-08-03-479-027.000-026",
"71-08-03-479-028.000-026",
"71-08-03-480-001.000-026",
"71-08-03-480-002.000-026",
"71-08-03-480-004.000-026",
"71-08-03-480-005.000-026",
"71-08-03-480-006.000-026",
"71-08-03-480-015.000-026",
"71-08-03-481-002.000-026",
"71-08-03-481-007.000-026",
"71-08-03-482-008.000-026",
"71-08-03-483-005.000-026",
"71-08-03-483-006.000-026",
"71-08-03-483-007.000-026",
"71-08-03-483-008.000-026",
"71-08-03-483-010.000-026",
"71-08-03-483-012.000-026",
"71-08-03-483-014.000-026",
"71-08-03-483-019.000-026",
"71-08-03-483-020.000-026",
"71-08-03-484-003.000-026",
"71-08-03-485-001.000-026",
"71-08-03-486-011.000-026",
"71-08-03-486-012.000-026",
"71-08-03-486-013.000-026",
"71-08-03-486-021.000-026",
"71-08-03-487-001.000-026",
"71-08-03-487-003.000-026",
"71-08-03-487-008.000-026",
"71-08-03-487-013.000-026",
"71-08-03-488-001.000-026",
"71-08-03-488-002.000-026",
"71-08-03-488-003.000-026",
"71-08-03-488-004.000-026",
"71-08-03-488-007.000-026",
"71-08-03-488-008.000-026",
"71-08-03-490-012.000-026",
"71-08-03-490-021.000-026",
"71-08-04-177-001.000-026",
"71-08-04-228-021.000-026",
"71-08-04-229-006.000-026",
"71-08-04-229-008.000-026",
"71-08-04-276-004.000-026",
"71-08-04-276-006.000-026",
"71-08-10-127-006.000-026",
"71-08-10-203-023.000-026",
"71-08-10-206-007.000-026",
"71-08-10-208-001.000-026",
"71-08-10-209-004.000-026",
"71-08-10-209-006.000-026",
"71-08-10-209-007.000-026",
"71-08-10-210-010.000-026",
"71-08-10-210-020.000-026",
"71-08-10-227-007.000-026",
"71-08-10-227-008.000-026",
"71-08-10-228-004.000-026",
"71-08-10-232-003.000-026",
"71-08-11-102-003.000-026",
"71-08-11-103-002.000-026",
"71-08-11-103-020.000-026",
"71-08-11-103-022.000-026",
"71-08-11-103-023.000-026",
"71-08-11-103-028.000-026",
"71-08-11-103-029.000-026",
"71-08-11-105-004.000-026",
"71-08-11-105-011.000-026",
"71-08-11-105-012.000-026",
"71-08-11-105-018.000-026",
"71-08-11-105-019.000-026",
"71-08-11-105-048.000-026",
"71-08-11-106-002.000-026",
"71-08-11-109-013.000-026",
"71-08-11-126-005.000-026",
"71-08-11-132-002.000-026",
"71-08-11-133-008.000-026",
"71-08-11-133-022.000-026",
"71-08-11-135-009.000-026",
"71-08-11-135-016.000-026",
"71-08-11-135-021.000-026",
"71-08-11-135-036.000-026",
"71-08-11-135-040.000-026",
"71-08-11-135-043.000-026",
"71-08-11-153-012.000-026",
"71-08-11-153-015.000-026",
"71-08-11-154-005.000-026",
"71-08-11-154-007.000-026",
"71-08-11-154-008.000-026",
"71-08-11-154-012.000-026",
"71-08-11-154-013.000-026",
"71-08-11-154-014.000-026",
"71-08-11-160-022.000-026",
"71-08-11-176-007.000-026",
"71-08-11-176-008.000-026",
"71-08-11-176-009.000-026",
"71-08-11-176-010.000-026",
"71-08-11-176-011.000-026",
"71-08-11-176-014.000-026",
"71-08-11-176-051.000-026",
"71-08-11-176-053.000-026",
"71-08-11-177-021.000-026",
"71-08-11-177-027.000-026",
"71-08-11-177-053.000-026",
"71-08-11-177-056.000-026",
"71-08-11-177-059.000-026",
"71-08-11-177-060.000-026",
"71-08-11-177-061.000-026",
"71-08-11-177-063.000-026",
"71-08-11-178-008.000-026",
"71-08-11-181-009.000-026",
"71-08-11-201-011.000-026",
"71-08-11-203-006.000-026",
"71-08-11-203-010.000-026",
"71-08-11-253-028.000-026",
"71-08-13-182-022.000-026",
"71-08-13-328-006.000-026",
"71-08-13-328-015.000-026",
"71-08-13-328-017.000-026",
"71-08-13-328-023.000-026",
"71-08-13-329-015.000-026",
"71-08-13-330-002.000-026",
"71-08-13-330-015.000-026",
"71-08-13-331-019.000-026",
"71-08-13-333-043.000-026",
"71-08-13-334-002.000-026",
"71-08-13-334-030.000-026",
"71-08-13-351-011.000-026",
"71-08-13-376-006.000-026",
"71-08-13-376-007.000-026",
"71-08-13-376-008.000-026",
"71-08-13-376-009.000-026",
"71-08-13-377-027.000-026",
"71-08-13-378-011.000-026",
"71-08-13-378-012.000-026",
"71-08-13-381-014.000-026",
"71-08-13-381-020.000-026",
"71-08-13-382-011.000-026",
"71-08-13-385-013.000-026",
"71-08-14-155-001.000-026",
"71-08-14-155-002.000-026",
"71-08-14-155-003.000-026",
"71-08-14-155-004.000-026",
"71-08-14-155-005.000-026",
"71-08-14-155-006.000-026",
"71-08-14-177-010.000-026",
"71-08-14-177-011.000-026",
"71-08-14-178-001.000-026",
"71-08-14-178-002.000-026",
"71-08-14-178-003.000-026",
"71-08-14-178-004.000-026",
"71-08-14-178-018.000-026",
"71-08-14-308-012.000-026",
"71-08-14-326-005.000-026",
"71-08-14-329-001.000-026",
"71-08-14-330-013.000-026",
"71-08-14-331-013.000-026",
"71-08-14-333-001.000-026",
"71-08-14-333-022.000-026",
"71-08-14-380-023.000-026",
"71-08-14-428-004.000-026",
"71-08-14-430-019.000-026",
"71-08-14-430-022.000-026",
"71-08-14-432-001.000-026",
"71-08-14-432-026.000-026",
"71-08-14-458-024.000-026",
"71-08-14-459-007.000-026",
"71-08-14-476-008.000-026",
"71-08-14-478-014.000-026",
"71-08-14-478-015.000-026",
"71-08-14-479-013.000-026",
"71-08-14-482-002.000-026",
"71-08-15-278-005.000-026",
"71-08-15-278-006.000-026",
"71-08-15-278-007.000-026",
"71-08-15-278-008.000-026",
"71-08-15-379-010.000-026",
"71-08-15-379-011.000-026",
"71-08-15-379-012.000-026",
"71-08-15-379-013.000-026",
"71-08-15-381-029.000-026",
"71-08-15-381-030.000-026",
"71-08-15-381-031.000-026",
"71-08-15-430-010.000-026",
"71-08-15-430-011.000-026",
"71-08-15-435-001.000-026",
"71-08-15-435-017.000-026",
"71-08-15-436-001.000-026",
"71-08-15-436-002.000-026",
"71-08-15-451-016.000-026",
"71-08-15-451-017.000-026",
"71-08-15-451-018.000-026",
"71-08-15-451-019.000-026",
"71-08-15-451-020.000-026",
"71-08-15-451-022.000-026",
"71-08-15-453-013.000-026",
"71-08-15-476-004.000-026",
"71-08-15-476-005.000-026",
"71-08-15-476-006.000-026",
"71-08-15-476-017.000-026",
"71-08-15-477-006.000-026",
"71-09-05-402-001.000-026",
"71-09-06-305-015.000-026",
"71-09-06-355-006.000-026",
"71-09-06-377-006.000-026"]

var CECount = 0;
var doubleAddr = ""

/*
	Main logic start
*/
for (x in CEParcelList201_400)
{
	var parcelObj = aa.parcel.getParceListForAdmin(CEParcelList201_400[x],null,null,null,null,null,null,null,null,null)
	
	if(parcelObj.getSuccess())
	{
		var parcel = parcelObj.getOutput()
		for(y in parcel)
		{
			var pMod = parcel[y].getParcelModel()
			var pKey = pMod.getParcelNumber()
			//aa.print(pKey)
			var pcCond = aa.parcelCondition.getParcelConditions(pKey)
			//aa.print(pcCond.getSuccess())
			
			if(pcCond.getSuccess())
			{
				CECount += 1
				var newCECap = createCap("Enforcement/Violations/Environmental/Continuous Enforcement", "Continuous Enforcement")
				createCapComment("CE record created in batch for start of cutting season.",newCECap)
				
				// Copy parcel to the new record
				var newCapParcel = aa.parcel.getCapParcelModel().getOutput();
				newCapParcel.setParcelModel(pMod);
				newCapParcel.setCapIDModel(newCECap);
				newCapParcel.setL1ParcelNo(pKey);
				newCapParcel.setParcelNo(pKey);
				aa.parcel.createCapParcel(newCapParcel);
				
				//Copy address to the new record
				var addrObj = aa.address.getAddressListForAdmin(pKey,null,null,null,null,null,null,null,null,null,null,null,null,null)
				if (addrObj.getSuccess())
				{
					var addrs = addrObj.getOutput();
					
					if(Object.keys(addrs).length > 1)
					{
						doubleAddr+=pKey+"\n"
					}
					for(addr in addrs)
					{
						var newAddress = addrs[addr].getRefAddressModel().toAddressModel()
						newAddress.setCapID(newCECap);
						aa.address.createAddressWithAPOAttribute(newCECap,newAddress);
					}
				}
				
				// Copy owner to the new record
				var parScriptMod = aa.parcel.getParcelDailyByCapID(newCECap,null)
				var parScripts = parScriptMod.getOutput()
				for(par in parScripts)
				{
					var ownObj = aa.owner.getOwnersByParcel(parScripts[par])
					
					if (ownObj.getSuccess())
					{
						var owners = ownObj.getOutput()
						for (owner in owners)
						{
							owners[owner].setCapID(newCECap)
							aa.owner.createCapOwnerWithAPOAttribute(owners[owner])
						}
					}
				}
				closeTaskCap("Case Intake", "Assigned", "Updated via batchCECaseCreation script.", null, null, newCECap)
				scheduleInspectionCap("Abatement", 1, "PARKSCREW", null, "Scheduled via batchCECaseCreation.",newCECap)
				
			}
			else
			{
				aa.print(pKey + " didn't have a CE condition. Please create manually.")
			}

		}
	}
}
aa.print("\nCECount: "+CECount)
aa.print("\n"+doubleAddr)

function getScriptText(vScriptName) {
    vScriptName = vScriptName.toUpperCase();
    var emseBiz = aa.proxyInvoker.newInstance("com.accela.aa.emse.emse.EMSEBusiness").getOutput();
    var emseScript = emseBiz.getMasterScript(aa.getServiceProviderCode(), vScriptName);
    return emseScript.getScriptText() + "";
}